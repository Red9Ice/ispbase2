# Скрипты импорта данных

## Импорт мероприятий из CSV

Скрипт `import-events.ts` импортирует данные о мероприятиях из файла `.ispdata` в базу данных PostgreSQL.

### Требования

1. База данных PostgreSQL должна быть настроена и доступна
2. Миграции должны быть применены (см. `docs/migrations/001_init.sql`)
3. Файл `.ispdata` должен находиться в корне проекта
4. Переменная окружения `DATABASE_URL` должна быть установлена (или используется значение по умолчанию)

### Запуск

```bash
cd backend
npm run import:events
```

Или с указанием DATABASE_URL:

```bash
DATABASE_URL=postgres://user:password@localhost:5432/imlight npm run import:events
```

### Что делает скрипт

1. Читает CSV файл `.ispdata` из корня проекта
2. Парсит данные о мероприятиях, клиентах и площадках
3. Создает или находит существующих клиентов по email
4. Создает или находит существующие площадки по городу и названию
5. Создает мероприятия в базе данных
6. Маппит статусы:
   - "Состоялось" → `completed`
   - "Отменилось" → `canceled`
   - "Объединено" → `completed`
   - "Событие" → `completed`
   - Остальные → `draft`

### Обработка данных

- Даты парсятся из формата `DD.MM.YYYY`
- Числа парсятся из русского формата (с пробелами и запятыми)
- Контакты клиентов извлекаются из строки "Контакт заказчика"
- Email используется как уникальный идентификатор клиента
- Площадки создаются по комбинации города и названия места

### Логирование

Скрипт выводит:
- Количество прочитанных строк
- Прогресс импорта (каждые 100 записей)
- Итоговую статистику (импортировано, пропущено, ошибок)
